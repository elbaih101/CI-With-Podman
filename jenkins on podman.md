# Setting Up a Scalable Jenkins CI/CD Environment with Podman

## Prerequisites

- Installed and operational Podman
- Network access
- Console access

## 1. Creating a Dedicated Network

First, create a separate network for Jenkins-related containers:

```sh
podman network create n_jenkins
```

## 2. Setting Up the Jenkins Pod

Create a new pod named `itcafe`:

```sh
podman pod create itcafe
```

## 3. Deploying the Jenkins Container

To ensure data persistence, create a volume for Jenkins data:

```sh
podman volume create jenkins_home
```

Then, create the Jenkins container within the `itcafe` pod:

```sh
podman create --pod itcafe --restart=on-failure \
  -v jenkins_home:/var/jenkins_home \
  --name jenkins --publish 8080:8080 \
  --network n_jenkins \
  --publish 50000:50000 \
  docker.io/jenkins/jenkins:lts-jdk17
```

Start the pod:

```sh
podman pod start itcafe
```

## 4. Initializing the Jenkins Controller

- Access the Jenkins Web UI at: `http://localhost:8080`
- Retrieve the initial admin password:

  ```sh
  podman exec jenkins \
    cat /var/jenkins_home/secrets/initialAdminPassword
  ```

- Use this password to log in and install the suggested plugins.

## 5. Adding Build Agents

To enhance scalability, add build agents:

1. In Jenkins, navigate to `Manage Jenkins` > `Nodes` > `New Node`.
2. Name the node, select "Permanent Agent," and set the remote root directory to `/home/jenkins/agent`.
3. Save the configuration to create an offline agent.
4. Obtain the agent's secret key from its configuration page.
5. Run the inbound-agent container:

   ```sh
   podman run --pod itcafe \
     -d --rm --name agent1 \
     --init docker.io/jenkins/inbound-agent \
     -url http://localhost:8080 \
     -secret <secret_code> \
     -name Agent1
   ```
This command runs a **Jenkins inbound agent** inside the `itcafe` pod using **Podman**. Let's break it down step by step:  

---

#### **1. `podman run`**  
- This tells Podman to start a new container.  

#### **2. `--pod itcafe`**  
- Runs the container inside an **existing Pod** named `itcafe`.  
- This ensures that the container shares **network and IPC namespaces** with other containers inside the pod.  
- The agent can communicate with Jenkins without extra networking configurations.  

#### **3. `-d`** (Detached Mode)  
- Runs the container in the background, so it doesnâ€™t block the terminal.  

#### **4. `--rm`**  
- Removes the container automatically when it stops.  
- Useful for temporary/ephemeral agents that donâ€™t need to persist.  

#### **5. `--name agent1`**  
- Assigns the name `agent1` to this container.  
- Makes it easier to reference later using commands like `podman logs agent1`.  

#### **6. `--init`**  
- Uses Podmanâ€™s **init system** to handle zombie processes inside the container.  
- Prevents issues when processes exit unexpectedly.  

#### **7. `docker.io/jenkins/inbound-agent`**  
- This is the container image from **Docker Hub** that contains the Jenkins agent software.  
- The `inbound-agent` connects to the Jenkins controller and waits for jobs to be assigned.  

#### **8. `-url http://localhost:8080`**  
- Specifies the URL of the **Jenkins controller** (running inside the same `itcafe` pod).  
- The agent uses this to register itself with Jenkins.  

#### **9. `-secret <secret_code>`**  
- This is a **unique token** generated by Jenkins when setting up a new agent.  
- Ensures secure authentication between the agent and Jenkins controller.  
- You can find this in Jenkins under **Manage Nodes and Clouds** â†’ Select your agent â†’ Copy the secret.  

#### **10. `-name Agent1`**  
- Sets the **display name** of the agent in Jenkins.  
- This is different from the container name (`agent1`); it is how Jenkins will identify the agent in its UI.  

---

### **Summary:**
This command **runs a temporary Jenkins agent** inside the `itcafe` pod. The agent connects to the **Jenkins controller** at `http://localhost:8080` using a **secret token** and registers as **Agent1** in Jenkins. When the agent stops, the container is automatically removed.

Would you like to modify anything, such as making the agent persistent instead of ephemeral? ðŸš€


6. Repeat these steps to add more agents as needed.

## 6. Creating Backups

To back up the Jenkins setup:

```sh
podman kube generate itcafe --filename jenkins.yml
```

Restore the setup using:

```sh
podman kube play jenkins.yml
```

For a detailed walkthrough, refer to the original article: [How To Create A Scalable Jenkins CI/CD Environment Using Containers?](https://tomsitcafe.com/2023/12/05/how-to-create-a-scalable-jenkins-ci-cd-environment-using-containers/)

